<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8" />
	<title>Upload</title>
	<link href="main-style.css" rel="stylesheet" type="text/css">
	<link href="http://fonts.cdnfonts.com/css/iceberg" rel="stylesheet">
	<script src="https://kit.fontawesome.com/dedab4d2ca.js" crossorigin="anonymous"></script>
</head>
<body>
	<h1>mandatory requests</h1>
	<div class="form_container">
	<form id="upload-form" method="POST" action="/cgi-bin/apply-for-iceberg.pl?path_info=/upload" enctype="multipart/form-data" alt="Upload file(s)">
		<p>
			<label for="upload_input_type_file">
				Select a file to upload <br/>    
				<i class="fa-regular fa-folder-open"></i>
				<input id="upload_input_type_file" type="file" name="form" accept="image/png, image/jpeg" required />
			<!--<input type="file" name="form" accept="image/png, image/jpeg" multiple required />-->
			</label>
		</p>
		<p>
			<input type="submit" name="submit" value="Book an iceberg" />
			<input type="reset" name="reset" value="Reset" />
		</p>
		<h2>POST request</h2>
	</form>
	<hr>
	<form id="delete-form" method="DELETE" action="/cgi-bin/apply-for-iceberg.pl?/upload" enctype="multipart/form-data" alt="Deletion files(s)">
		<p>
			<label for="delfile">
				Select a file to delete  <br/>   
				<i class="fa-regular fa-folder-open"></i>
				<input id="delfile" type="file" name="form" value="R-42" accept="image/png, image/jpeg" multiple required />
			</label>
		</p>
		<p class="hidden">
			<input class="hidden" type="hidden" name="path_info" value="/upload"/>
		</p>
		<p>
			<input type="submit" name="submit" value="Delete an iceberg" />
			<input type="reset" name="reset" value="Reset" />
		</p>
		<h2>DELETE request</h2>
		<pre id="output" style="max-height:300px;">
		</pre>
	</form>
	<script>
	document.getElementById('delete-form').addEventListener('submit', function (event) {
		const data = new URLSearchParams(new FormData(document.getElementById('delete-form')))

		let nb_files = document.getElementById('delfile').files.length;
		data.append("nb_files", nb_files);

		const nb_files_int = parseInt(nb_files, 10);
		let i=0;
		while (i < nb_files_int)
		{
			file = document.getElementById('delfile').files[i].name;
			data.append("filename" + i.toString(), file);
			i++;
		}

		let delete_header = new Headers();
		delete_header.append('Content-Type', 'multipart/form-data');
		
		fetch(document.getElementById('delete-form').action, {
			headers: delete_header,
		    method: 'DELETE',
		    body: data,
		}).then(function(response) {
			return response.text()
		})
		.then((data) => {
			document.getElementById('output').textContent += "Request sent ";
			location.reload();
			//document.getElementById('output').textContent += data
		})


		event.preventDefault()
	})
	</script>
	<!--<script>
		document.getElementById('upload-form').addEventListener('submit', function(event) { 
					location.reload(); 
					event.preventDefault()
				})
	</script>-->
	<hr>
	<form id="gallery-form" method="GET" action="/cgi-bin/apply-for-iceberg.pl?path_info=/upload" enctype="multipart/form-data" alt="Gallery">
		<p class="hidden">
			<input type="hidden" name="path_info" value="/upload"/>
		</p>
		<p>
			Want to see the gallery ?
		</p>
		<p>
			<input type="submit" name="submit" value="Get an iceberg" />
			<input type="reset" name="reset" value="Reset" />
		</p>
		<h2>GET request</h2>
	</form>
	</div>
	<hr>
	<p>
		<a href="../index.html" alt="Are you lost?">Are you lost?</a>
	</p>
</body>
</script>
</html>
