<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8" />
	<title>Upload</title>
	<link href="main-style.css" rel="stylesheet" type="text/css">
	<link href="http://fonts.cdnfonts.com/css/iceberg" rel="stylesheet">
	<script src="https://kit.fontawesome.com/dedab4d2ca.js" crossorigin="anonymous"></script>
</head>
<body>
	<h1>mandatory requests</h1>
	<div class="form_container">
	<form id="upload-form" method="POST" action="/cgi-bin/apply-for-iceberg.pl?path_info=/upload" enctype="multipart/form-data" alt="Upload file(s)">
		<p>
			<label for="upload_input_type_file">
				Select a file to upload <br/>    
				<i class="fa-regular fa-folder-open"></i>
				<input id="upload_input_type_file" type="file" name="form" accept="image/png, image/jpeg" onchange="previewPicture(this);" multiple required />
			</label>
		</p>
		<p>
			<input type="submit" name="submit" value="Book an iceberg" />
			<input type="reset" name="reset" value="Reset" />
		</p>
		<h2>POST request</h2>
	</form>
	<hr>
	<form id="delete-form" method="DELETE" action="#" enctype="multipart/form-data" alt="Deletion files(s)">
		<p>
			<label for="delfile">
				Select a file to delete  <br/>   
				<i class="fa-regular fa-folder-open"></i>
				<input id="delfile" type="file" accept="image/png, image/jpeg" enctype="multipart/form-data" multiple required />
			</label>
		</p>
		<p class="hidden">
			<input class="hidden" type="hidden" name="path_info" value="/upload"/>
		</p>
		<p>
			<input type="submit" name="submit" value="Delete an iceberg" />
			<input type="reset" name="reset" value="Reset" />
		</p>
		<h2>DELETE request</h2>
		<pre id="output" style="max-height:300px;">
		</pre>
	</form>
	<script>
	document.getElementById('delete-form').addEventListener('submit', function (event) {
		const data = new URLSearchParams(new FormData(document.getElementById('delete-form')))

		let nb_files = document.getElementById('delfile').files.length;

		const nb_files_int = parseInt(nb_files, 10);
		let i = 0;
		while (i < nb_files_int)
		{
			file = document.getElementById('delfile').files[i].name;
			data.append("filename" + i.toString(), file);
			i++;
				function reqListener() {
					console.log(this.responseText);
				}

				const req = new XMLHttpRequest();
				req.open("DELETE", "http://127.0.0.1:4242/upload/" + file);
				req.send();
		}

		event.preventDefault()
	})
	</script>
	<hr>
	<form id="gallery-form" method="GET" action="/cgi-bin/apply-for-iceberg.pl?path_info=/upload" enctype="multipart/form-data" alt="Gallery">
		<p class="hidden">
			<input type="hidden" name="path_info" value="/upload"/>
		</p>
		<p>
			Want to see the gallery ?
		</p>
		<p>
			<input type="submit" name="submit" value="Get an iceberg" />
			<input type="reset" name="reset" value="Reset" />
		</p>
		<h2>GET request</h2>
	</form>
	</div>
	<!---->
	<img src="#" id="img-prev" hidden>
	<script type="text/javascript" >
    // L'image img#image
    var image = document.getElementById("img-prev");

    // La fonction previewPicture
    var previewPicture  = function (e) {

        // e.files contient un objet FileList
        const [picture] = e.files

        // "picture" est un objet File
        if (picture) {
            // On change l'URL de l'image
            image.src = URL.createObjectURL(picture);
			image.hidden = false;
        }
    }
</script>
	<hr>
	<div class="illustration">
		<div class="i-large"></div>
		<div class="i-medium"></div>
		<div class="i-small"></div>
	</div>
	<p>
		<a href="../index.html" alt="Are you lost?">Are you lost?</a>
	</p>
</body>
</html>
